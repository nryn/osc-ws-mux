const rawMessageContainer=document.getElementById("rawMessageContainer"),pre=document.getElementById("rawMessage"),host=window.location.host,parsedHost=host.split(":")[0],str=e=>JSON.stringify(e),recordingsContainer=document.getElementById("recordingsContainer"),populateRecordings=e=>{recordingsContainer.innerHTML="";for(let t of e){const e=t.replace(".json",""),s=document.createElement("div");s.id=`recording-${e}`,s.classList.add("playbackButton"),s.classList.add("button"),s.addEventListener("click",e=>{if(!e)e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),ws.send(str({type:"playRecording",recording:t})),setTimeout(()=>{ws.send(str({type:"playingStatus"}))},100)});const n=document.createElement("img");n.classList.add("svgIcon"),n.setAttribute("src","./icons/play.svg");const o=document.createElement("span");o.innerText=e,s.appendChild(n),s.appendChild(o);const a=document.createElement("img");a.classList.add("svgIcon"),a.setAttribute("src","./icons/delete.svg"),a.addEventListener("click",s=>{if(!s)s=window.event;s.cancelBubble=!0,s.stopPropagation&&s.stopPropagation(),confirm(`Are you sure you want to delete recording ${e}?`)&&(ws.send(str({type:"deleteRecording",recording:t})),setTimeout(()=>{ws.send(str({type:"loadRecordings"}))},100))}),s.appendChild(a),recordingsContainer.appendChild(s)}},toggleRecordingButton=document.getElementById("toggleRecordingButton");toggleRecordingButton.addEventListener("click",e=>{if(!e)e=window.event;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),ws.send(str({type:"toggleRecording"})),setTimeout(()=>{ws.send(str({type:"loadRecordings"}))},100)});const colorRecordingButton=e=>{const t=document.createElement("img");t.classList.add("svgIcon"),t.classList.add("recordingIcon"),t.setAttribute("src",`./icons/${e?"stop":"record"}.svg`);const s=document.createElement("span");s.innerText=`${e?"Stop":"Start"} Recording`,toggleRecordingButton.innerHTML="",toggleRecordingButton.appendChild(t),toggleRecordingButton.appendChild(s),toggleRecordingButton.classList[e?"add":"remove"]("recording")},colorPlaybackButton=e=>{const t=document.getElementsByClassName("playbackButton");for(let e of t)e.classList.remove("playing");for(let t of e){const e=t.replace(".json","");document.getElementById(`recording-${e}`).classList.add("playing")}},wsAddress=document.getElementById("wsAddress"),wsPort=document.getElementById("wsPort");let broadcastIntervalInMs=100;const broadcastInterval=document.getElementById("broadcastInterval");broadcastInterval.addEventListener("change",()=>{ws.send(str({type:"setIoConfig",broadcastInterval:broadcastInterval.value}))}),broadcastInterval.addEventListener("keypress",e=>("Enter"==e.key&&e.preventDefault(),!1));const oscRelayToggle=document.getElementById("oscRelayToggle");oscRelayToggle.addEventListener("click",()=>{ws.send(str({type:"setIoConfig",oscRelayEnabled:oscRelayToggle.checked}))});const oscDestinationAddress=document.getElementById("oscDestinationAddress");oscDestinationAddress.addEventListener("change",()=>{ws.send(str({type:"setIoConfig",oscDestinationAddress:oscDestinationAddress.value}))});const oscDestinationPort=document.getElementById("oscDestinationPort");oscDestinationPort.addEventListener("change",()=>{ws.send(str({type:"setIoConfig",oscDestinationPort:oscDestinationPort.value}))});const populateIoConfig=(e,t,s,n,o)=>{wsAddress.value=parsedHost,oscDestinationAddress!==document.activeElement&&(oscDestinationAddress.value=e),oscDestinationPort!==document.activeElement&&(oscDestinationPort.value=t),wsPort.value=s,oscRelayToggle.checked=n,broadcastInterval!==document.activeElement&&(broadcastInterval.value=o)};let staleTimer=null;const freshenUpForMs=e=>{rawMessageContainer.classList.remove("stale"),staleTimer&&clearTimeout(staleTimer),staleTimer=setTimeout(()=>{rawMessageContainer.classList.add("stale")},e)},ws=new WebSocket(`ws://${parsedHost}:8080/ws`);ws.onopen=(()=>{ws.send(str({type:"loadRecordings"})),ws.send(str({type:"recordingStatus"})),ws.send(str({type:"playingStatus"})),ws.send(str({type:"ioConfig"}))}),ws.onmessage=(e=>{const t=JSON.parse(e.data);switch(t.type){case"recordingsData":populateRecordings(t.recordings);break;case"recordingStatus":colorRecordingButton(t.isRecording);break;case"playingStatus":colorPlaybackButton(t.nowPlaying);break;case"ioConfig":populateIoConfig(t.oscDestinationAddress,t.oscDestinationPort,t.websocketBroadcastPort,t.oscRelayEnabled,t.broadcastInterval),broadcastIntervalInMs=t.broadcastInterval,"initialMessage"===pre.className&&(pre.innerHTML=`Waiting for OSC messages on ${parsedHost}:${t.oscReceiverPort||"????"}`,pre.classList.remove("initialMessage"));break;default:pre.innerHTML=e.data,freshenUpForMs(2*broadcastIntervalInMs)}});